---
title: "Smoking Rates in the United States Over Time"
author: "Hunter Huckabay and Ivy Gates"
format: revealjs
editor_options: 
  chunk_output_type: console
---

# Introduction 
- According to the American Lung Association, cigarette smoking rates have fallen significantly for both adults and youth since the 1990s. 
 
 - However, the National Institute of Health has found that the rate of e-cigarette use has increased from 1.5% in 2011 to 20.8% in 2018. Our goal of this project is to compare cigarette use to e-cigarette use in America. 
 
 - We aim to see what age groups smoking is the most popular as well as what type of tobacco product is most popular.


```{r}
library(tidyverse)
library(lubridate)
library(janitor)
library(RColorBrewer)
library(ggplot2)
library(tinytable)
library(tidyr)

```


# Smoking Trends in 2011

```{r}
National <- data.frame(
  Year = 2011,
  Smoke_everday = 15.4,
  Smoke_some_days = 5.7,
  Former_smoker = 25.0,
  Never_Smoked = 52.9
)

long_data <- National %>%
  pivot_longer(cols = -Year, names_to = "Category", values_to = "Value")

ggplot(long_data, aes(x = Category, y = Value, fill = Category)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Smoking in 2011",
    x = "Category",
    y = "Percent"
  ) +
  theme_minimal()
```



## National Smoking Trends from 1995 to 2011

```{r}
Smoking <- read.csv("Current smoking.csv")

national_rates <- Smoking |> 
  group_by (Year) |> 
  summarize(national_average = mean(Smokes))

ggplot( national_rates, aes(x=Year, y = national_average)) + 
  geom_line() + 
  expand_limits( y = 0 ) +
  theme( legend.position = "none")
```

## Average Percent of smokers by state

```{r}

SmokingComparison <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQpaipO6PCy05bqlnIa9tHQtVd_6XCx24IV1ZWkgXkKRDBlC1ZLj4sqXng6ely60kqjrKF1U9Pq_5qX/pub?output=csv",show_col_types = FALSE)

Smoking_Difference <- SmokingComparison |>
  group_by(Year) |>
  summarize( TeenRate = c(`Smoking Rate(Teen)` ) / 1e8,
             AdultRate = c( `Smoking Rate(Adult)` ) / 1e7 )

Smoking_Difference$Difference <- Smoking_Difference$TeenRate - Smoking_Difference$AdultRate

# make a decent table:
tt(Smoking_Difference, 
    caption = "Difference of Smoking Rates between Teens and Adults from 1995 to 2011", 
    theme = "striped" )

             

```

## Choropleth

```{r}
#| eval: FALSE
install.packages("usmap")
install.packages("ggplot2")
```

## Map of Smoking Rates by States

```{r}
library(plotly)
library(dplyr)

state_data <- State_Stats %>%
  mutate(code = state.abb[match(State, state.name)]) 
# Create interactive choropleth
plot_geo(state_data, locationmode = 'USA-states') %>%
  add_trace(
    z = ~AVERAGE,
    locations = ~code,
    color = ~AVERAGE,
    colors = 'Blues',
    text = ~paste(State, "<br>Avg Smokers: ", round(AVERAGE, 1), "%"),
    hoverinfo = "text"
  ) %>%
  layout(
    title = "Average Percentage of Smokers by State (Interactive)",
    geo = list(scope = 'usa')
  )

```


## Use of E-Cigarettes by High Schoolers

```{r}
Electronic_Data <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQgWlcmg0jQ88_JLaqI-E8_fjQFtMaZpilkSiOHRBjyV5UDGlAiSRtUQekIfrjMPzySf1yyUMCN2j3I/pub?output=csv")

ggplot(Electronic_Data, aes(x = Year, y = `Percent of Teens Smoking`)) + 
  geom_line() + 
  expand_limits( y = 0 ) +
  theme( legend.position = "none")
```

```{r}
# Keep data starting at 2014
teen_data_filtered <- Electronic_Data %>%
  filter(Year >= 2014)

Adult_Electronic_Data <- read.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQQL58TQVvSt4ymMtnNpKMs5jDNm63XYsULxwz4eclvkScSpqlEfbutoMv-QutQJY0WBNV0WdJ01QW3/pub?output=csv")

# Merge These datasets and format them for a graph
Combined_Electronic_Data <- left_join(Adult_Electronic_Data, Electronic_Data, by = "Year")

Long_Electronic_Data <- pivot_longer(Combined_Electronic_Data, cols = c('Percent.of.Adults.Smoking', 'Percent of Teens Smoking'),
                                     names_to = "Age",
                                     values_to = "Rate")


# Create a graph

ggplot(Long_Electronic_Data, aes(x = Year, y = Rate, color = Age)) +
  geom_line(size = 1.2) +
  theme_minimal() +
  labs(title = "Use of E-Cigarettes by Teens vs. Adults",
       x = "Year",
       y = "Rate of use",
       color = "Age")
                                              



```

